<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    编程实例 | fungis Blog
  </title>
  <meta name="description" content="一个热爱生活、努力搬砖、乐于分享的giser">
  
  <meta name="keywords" content="
  
  ">
  
  <meta name="author" content="努力搬砖的giser">

  <meta http-equiv="Cache-Control" content="no-transform"/>
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://github.githubassets.com/favicon.ico">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  

  

  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
<meta name="generator" content="Hexo 4.2.1"></head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div>
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="https://octodex.github.com/images/baracktocat.jpg"> <i class="fa fa-caret-down"></i></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i
                  class="fa fa-file-text"></i> Posts </a>
        <a href="/archives"
           class="header-toolbar-right"> 3 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i
                  class="fa fa-tags"></i> Tags </a>
        <a href="/tags"
           class="header-toolbar-right"> 0 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i
                  class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories"
           class="header-toolbar-right"> 0 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">fungis Blog</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    努力搬砖的giser

    <span class="post-date float-right" title="{{moment(1591982251590).format('MMM DD, YYYY, h:mm:ss A')}}">
      
          <i class="fa fa-pencil-square-o"></i>
      
      {{moment(1591982251590).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1>编程实例</h1>
    <h6 id="保存与另存为"><a href="#保存与另存为" class="headerlink" title="保存与另存为"></a>保存与另存为</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">private void 保存ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        string sMxdFileName &#x3D; axMapControl1.DocumentFilename;</span><br><span class="line">        IMapDocument pMapDocument &#x3D; new MapDocument();</span><br><span class="line">        if (sMxdFileName !&#x3D; null &amp;&amp; axMapControl1.CheckMxFile(sMxdFileName))</span><br><span class="line">        &#123;</span><br><span class="line">            if (pMapDocument.get_IsReadOnly(sMxdFileName))</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(&quot;本地图文档是只读的，不能保存!&quot;);</span><br><span class="line">                pMapDocument.Close();</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            SaveFileDialog pSaveFileDialog &#x3D; new SaveFileDialog();</span><br><span class="line">            pSaveFileDialog.Title &#x3D; &quot;请选择保存路径&quot;;</span><br><span class="line">            pSaveFileDialog.OverwritePrompt &#x3D; true;</span><br><span class="line">            pSaveFileDialog.Filter &#x3D; &quot;ArcMap文档（*.mxd）|*.mxd|ArcMap模板（*.mxt）|*.mxt&quot;;</span><br><span class="line">            pSaveFileDialog.RestoreDirectory &#x3D; true;</span><br><span class="line">            if (pSaveFileDialog.ShowDialog() &#x3D;&#x3D; DialogResult.OK)</span><br><span class="line">            &#123;</span><br><span class="line">                sMxdFileName &#x3D; pSaveFileDialog.FileName;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        pMapDocument.New(sMxdFileName);</span><br><span class="line">        pMapDocument.ReplaceContents(axMapControl1.Map as IMxdContents);</span><br><span class="line">        pMapDocument.Save(pMapDocument.UsesRelativePaths, true);</span><br><span class="line">        pMapDocument.Close();</span><br><span class="line">        MessageBox.Show(&quot;保存地图文档成功!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    catch &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="地图操作小工具"><a href="#地图操作小工具" class="headerlink" title="地图操作小工具"></a>地图操作小工具</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private void 拉框放大ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ICommand pCommand &#x3D; new ControlsMapZoomInTool();</span><br><span class="line">            pCommand.OnCreate(axMapControl1.Object);</span><br><span class="line">            axMapControl1.CurrentTool &#x3D; pCommand as ITool;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">private void 要素选择ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ICommand pCommand &#x3D; new ControlsSelectFeaturesTool ();</span><br><span class="line">            pCommand.OnCreate(axMapControl1.Object);</span><br><span class="line">            axMapControl1.CurrentTool &#x3D; pCommand as ITool;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">private void 中心放大ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            IEnvelope objEnvelope &#x3D; null;</span><br><span class="line">            objEnvelope &#x3D; axMapControl1.Extent;</span><br><span class="line">            objEnvelope.Expand(0.5, 0.5, true);</span><br><span class="line">            axMapControl1.Extent &#x3D; objEnvelope;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h6 id="右键菜单及其功能"><a href="#右键菜单及其功能" class="headerlink" title="右键菜单及其功能"></a>右键菜单及其功能</h6><p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5Cae01.png" alt="ae01"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;TOC菜单-定义变量（MainForm.cs）</span><br><span class="line">IFeatureLayer pTocFeatureLayer &#x3D; null;            &#x2F;&#x2F;点击的要素图层</span><br><span class="line">private OpenAttributeForm openAttributeForm;      &#x2F;&#x2F;属性表窗体</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">private void axTOCControl1_OnMouseDown(object sender, ITOCControlEvents_OnMouseDownEvent e)</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                if (axMapControl1.LayerCount !&#x3D; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    &#x2F;&#x2F;弹出目录栏右键菜单</span><br><span class="line">                    if (e.button &#x3D;&#x3D; 2)</span><br><span class="line">                    &#123;</span><br><span class="line">                        esriTOCControlItem pItem &#x3D; esriTOCControlItem.esriTOCControlItemNone;</span><br><span class="line">                        IBasicMap pMap &#x3D; null;</span><br><span class="line">                        ILayer pLayer &#x3D; null;</span><br><span class="line">                        object unk &#x3D; null;</span><br><span class="line">                        object data &#x3D; null;</span><br><span class="line">                        axTOCControl1.HitTest(e.x, e.y, ref pItem, ref pMap, ref pLayer, ref unk, ref data);</span><br><span class="line">                        pTocFeatureLayer &#x3D; pLayer as IFeatureLayer;</span><br><span class="line">                        if (pItem &#x3D;&#x3D; esriTOCControlItem.esriTOCControlItemLayer &amp;&amp; pTocFeatureLayer !&#x3D; null)</span><br><span class="line">                        &#123;</span><br><span class="line">                            图层可选ToolStripMenuItem.Enabled &#x3D; !pTocFeatureLayer.Selectable;</span><br><span class="line">                            图层不可选ToolStripMenuItem.Enabled &#x3D; pTocFeatureLayer.Selectable;</span><br><span class="line">                            this.contextMenuStrip1.Show(Control.MousePosition);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch &#123;&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">private void 打开属性表ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            openAttributeForm &#x3D; new OpenAttributeForm();</span><br><span class="line">            openAttributeForm.PFeatureLayer &#x3D; pTocFeatureLayer;</span><br><span class="line">            openAttributeForm.CurrentMap &#x3D; axMapControl1.Map;</span><br><span class="line">            openAttributeForm.initUI();</span><br><span class="line">            openAttributeForm.Show();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">private void 图层不可选ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            pTocFeatureLayer.Selectable &#x3D; false;</span><br><span class="line">            图层不可选ToolStripMenuItem.Enabled &#x3D; !图层不可选ToolStripMenuItem.Enabled;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">private void 图层可选ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            pTocFeatureLayer.Selectable &#x3D; true;</span><br><span class="line">            图层不可选ToolStripMenuItem.Enabled &#x3D; !图层不可选ToolStripMenuItem.Enabled;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">private void 缩放至图层ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (pTocFeatureLayer &#x3D;&#x3D; null) return;</span><br><span class="line">            axMapControl1.FullExtent &#x3D; pTocFeatureLayer.AreaOfInterest;</span><br><span class="line">            axMapControl1.Refresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void 移除图层ToolStripMenuItem_Click(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            if (pTocFeatureLayer &#x3D;&#x3D; null) return;</span><br><span class="line">            DialogResult result &#x3D; MessageBox.Show(&quot;确定要移除[&quot; + pTocFeatureLayer.Name + &quot;]图层吗？&quot;, &quot;提示&quot;, MessageBoxButtons.YesNo, MessageBoxIcon.Warning);</span><br><span class="line">            if (result &#x3D;&#x3D; DialogResult.Yes)</span><br><span class="line">            &#123;</span><br><span class="line">                axMapControl1.Map.DeleteLayer(pTocFeatureLayer);</span><br><span class="line">            &#125;</span><br><span class="line">            axMapControl1.Refresh();</span><br><span class="line">            axTOCControl1.Refresh();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>属性表窗体</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">private IMap currentMap;    &#x2F;&#x2F;当前MapControl控件中的Map对象</span><br><span class="line">     private IFeatureLayer pFeatureLayer;</span><br><span class="line"></span><br><span class="line">     public IMap CurrentMap</span><br><span class="line">     &#123;</span><br><span class="line">         get &#123; return currentMap; &#125;</span><br><span class="line">         set &#123; currentMap &#x3D; value; &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line"></span><br><span class="line">     public IFeatureLayer PFeatureLayer</span><br><span class="line">     &#123;</span><br><span class="line">         get &#123; return pFeatureLayer; &#125;</span><br><span class="line">         set &#123; pFeatureLayer &#x3D; value; &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     public void initUI()</span><br><span class="line">     &#123;</span><br><span class="line">         if (pFeatureLayer &#x3D;&#x3D; null)</span><br><span class="line">         &#123;</span><br><span class="line">             return;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         IFeature pFeature &#x3D; null;</span><br><span class="line">         DataTable pFeatDT &#x3D; new DataTable(); &#x2F;&#x2F;创建数据表</span><br><span class="line">         DataRow pDataRow &#x3D; null; &#x2F;&#x2F;数据表行变量</span><br><span class="line">         DataColumn pDataCol &#x3D; null; &#x2F;&#x2F;数据表列变量</span><br><span class="line"></span><br><span class="line">         for (int i &#x3D; 0; i &lt; pFeatureLayer.FeatureClass.Fields.FieldCount; i++)</span><br><span class="line">         &#123;</span><br><span class="line">             pDataCol &#x3D; new DataColumn();</span><br><span class="line">             pDataCol.ColumnName &#x3D; pFeatureLayer.FeatureClass.Fields.get_Field(i).AliasName;</span><br><span class="line">             pDataCol.DataType &#x3D; Type.GetType(&quot;System.Object&quot;);&#x2F;&#x2F;定义列字段类型</span><br><span class="line">             pFeatDT.Columns.Add(pDataCol);</span><br><span class="line">         &#125;</span><br><span class="line">         IFeatureCursor pFeatureCursor &#x3D; pFeatureLayer.Search(null, true);</span><br><span class="line">         pFeature &#x3D; pFeatureCursor.NextFeature();</span><br><span class="line">         while (pFeature !&#x3D; null)</span><br><span class="line">         &#123;</span><br><span class="line">             pDataRow &#x3D; pFeatDT.NewRow();</span><br><span class="line">             for (int k &#x3D; 0; k &lt; pFeatDT.Columns.Count; k++)</span><br><span class="line">             &#123;</span><br><span class="line">                 pDataRow[k] &#x3D; pFeature.get_Value(k);</span><br><span class="line">             &#125;</span><br><span class="line">             pFeatDT.Rows.Add(pDataRow);</span><br><span class="line">             pFeature &#x3D; pFeatureCursor.NextFeature();</span><br><span class="line">         &#125;</span><br><span class="line">         &#x2F;&#x2F;释放指针</span><br><span class="line">         System.Runtime.InteropServices.Marshal.ReleaseComObject(pFeatureCursor);</span><br><span class="line">         &#x2F;&#x2F;加入数据</span><br><span class="line">         dataGridView1.DataSource &#x3D; pFeatDT;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     #region 缩放至要素，并高亮显示</span><br><span class="line">     private void dataGridView1_CellClick(object sender, DataGridViewCellEventArgs e)</span><br><span class="line">     &#123;</span><br><span class="line">         try</span><br><span class="line">         &#123;</span><br><span class="line">             if (e.RowIndex &#x3D;&#x3D; -1) return;</span><br><span class="line">             DataGridViewRow row &#x3D; dataGridView1.Rows[e.RowIndex];</span><br><span class="line">             int objectID &#x3D; Convert.ToInt32(row.Cells[0].Value);</span><br><span class="line">             IFeature feature &#x3D; pFeatureLayer.FeatureClass.GetFeature(objectID);</span><br><span class="line"></span><br><span class="line">             IFeatureSelection selection &#x3D; pFeatureLayer as IFeatureSelection;</span><br><span class="line">             selection.Clear();</span><br><span class="line">             selection.Add(feature);</span><br><span class="line"></span><br><span class="line">             ESRI.ArcGIS.Geometry.IEnvelope outEnvelope &#x3D; new 						ESRI.ArcGIS.Geometry.Envelope() as IEnvelope;</span><br><span class="line">             feature.Shape.QueryEnvelope(outEnvelope);</span><br><span class="line">             IActiveView activeView &#x3D; CurrentMap as IActiveView;</span><br><span class="line">             activeView.Extent &#x3D; outEnvelope;</span><br><span class="line">             activeView.Refresh();</span><br><span class="line">         &#125;</span><br><span class="line">         catch &#123; &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     #endregion</span><br></pre></td></tr></table></figure>

<h6 id="鹰眼图的实现"><a href="#鹰眼图的实现" class="headerlink" title="鹰眼图的实现"></a>鹰眼图的实现</h6><p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5C%E9%B9%B0%E7%9C%BC%E5%9B%BE.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">private void axMapControl1_OnMapReplaced(object sender, IMapControlEvents2_OnMapReplacedEvent e) </span><br><span class="line">&#123; </span><br><span class="line">	&#x2F;&#x2F; 当主地图显示控件的地图更换时，鹰眼中的地图也跟随更换 </span><br><span class="line">	this.axMapControl2.Map &#x3D; new Map (); </span><br><span class="line">	&#x2F;&#x2F; 添加主地图控件中的所有图层到鹰眼控件中 </span><br><span class="line">    for (int i &#x3D; 1; i &lt;&#x3D; this.axMapControl1.LayerCount; i++) </span><br><span class="line">    &#123; </span><br><span class="line">        axMapControl2.AddLayer(axMapControl1.get_Layer(this.axMapControl1.LayerCount - i)); </span><br><span class="line">    &#125; </span><br><span class="line">	&#x2F;&#x2F; 设置 MapControl 显示范围至数据的全局范围 </span><br><span class="line">	axMapControl2.Extent &#x3D; axMapControl1.FullExtent; </span><br><span class="line">	&#x2F;&#x2F; 刷新鹰眼控件地图 </span><br><span class="line">	axMapControl2.Refresh(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void axMapControl1_OnExtentUpdated(object sender, IMapControlEvents2_OnExtentUpdatedEvent e) </span><br><span class="line">&#123; </span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F; 得到新范围 </span><br><span class="line">            IEnvelope pEnv &#x3D; (IEnvelope)e.newEnvelope;</span><br><span class="line">            IGraphicsContainer pGra &#x3D; axMapControl2.Map as IGraphicsContainer;</span><br><span class="line">            IActiveView pAv &#x3D; pGra as IActiveView;</span><br><span class="line">            &#x2F;&#x2F; 在绘制前，清除 axMapControl2 中的任何图形元素 </span><br><span class="line">            pGra.DeleteAllElements();</span><br><span class="line">            IRectangleElement pRectangleEle &#x3D; new RectangleElement() as IRectangleElement;</span><br><span class="line">            IElement pEle &#x3D; pRectangleEle as IElement;</span><br><span class="line">            pEle.Geometry &#x3D; pEnv;</span><br><span class="line">            &#x2F;&#x2F; 设置鹰眼图中的红线框 </span><br><span class="line">            IRgbColor pColor &#x3D; new RgbColor();</span><br><span class="line">            pColor.Red &#x3D; 255; pColor.Green &#x3D; 0; pColor.Blue &#x3D; 0;</span><br><span class="line">            pColor.Transparency &#x3D; 255;</span><br><span class="line">            &#x2F;&#x2F; 产生一个线符号对象 </span><br><span class="line">            ILineSymbol pOutline &#x3D; new SimpleLineSymbol();</span><br><span class="line">            pOutline.Width &#x3D; 2;</span><br><span class="line">            pOutline.Color &#x3D; pColor;</span><br><span class="line">            &#x2F;&#x2F; 设置颜色属性 </span><br><span class="line">            pColor &#x3D; new RgbColor();</span><br><span class="line">            pColor.Red &#x3D; 255; pColor.Green &#x3D; 0; pColor.Blue &#x3D; 0;</span><br><span class="line">            pColor.Transparency &#x3D; 0;</span><br><span class="line">            &#x2F;&#x2F; 设置填充符号的属性 </span><br><span class="line">            IFillSymbol pFillSymbol &#x3D; new SimpleFillSymbol();</span><br><span class="line">            pFillSymbol.Color &#x3D; pColor;</span><br><span class="line">            pFillSymbol.Outline &#x3D; pOutline;</span><br><span class="line">            IFillShapeElement pFillShapeEle &#x3D; pEle as IFillShapeElement;</span><br><span class="line">            pFillShapeEle.Symbol &#x3D; pFillSymbol;</span><br><span class="line">            pGra.AddElement((IElement)pFillShapeEle, 0);</span><br><span class="line">            &#x2F;&#x2F; 刷新 </span><br><span class="line">            pAv.PartialRefresh(esriViewDrawPhase.esriViewGraphics, null, null);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void axMapControl2_OnMouseDown(object sender, IMapControlEvents2_OnMouseDownEvent e) </span><br><span class="line">&#123; </span><br><span class="line">    if (this.axMapControl2.Map.LayerCount !&#x3D; 0) </span><br><span class="line">    &#123; </span><br><span class="line">        &#x2F;&#x2F; 按下鼠标左键移动矩形框 </span><br><span class="line">        if (e.button &#x3D;&#x3D; 1) </span><br><span class="line">        &#123; </span><br><span class="line">        IPoint pPoint &#x3D; new ESRI.ArcGIS.Geometry.Point(); </span><br><span class="line">        pPoint.PutCoords(e.mapX, e.mapY); </span><br><span class="line">        IEnvelope pEnvelope &#x3D; this.axMapControl1.Extent; </span><br><span class="line">        pEnvelope.CenterAt(pPoint); </span><br><span class="line">        this.axMapControl1.Extent &#x3D; pEnvelope; </span><br><span class="line">        &#x2F;&#x2F; PartialRefresh() 局部刷新以减少闪烁</span><br><span class="line">        this.axMapControl1.ActiveView.PartialRefresh(esriViewDrawPhase.esriViewGeography, null, null); </span><br><span class="line">    &#125; </span><br><span class="line">    &#x2F;&#x2F; 按下鼠标右键绘制矩形框 </span><br><span class="line">    else if (e.button &#x3D;&#x3D; 2) </span><br><span class="line">    &#123; </span><br><span class="line">        IEnvelope pEnvelop &#x3D; this.axMapControl2.TrackRectangle(); </span><br><span class="line">        this.axMapControl1.Extent &#x3D; pEnvelop; </span><br><span class="line">        this.axMapControl1.ActiveView.PartialRefresh(esriViewDrawPhase.esriViewGeography, null, null); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void axMapControl2_OnMouseMove(object sender, IMapControlEvents2_OnMouseMoveEvent e) </span><br><span class="line">&#123; </span><br><span class="line">    &#x2F;&#x2F; 如果不是左键按下就直接返回 </span><br><span class="line">    if (e.button !&#x3D; 1) return; </span><br><span class="line">    IPoint pPoint &#x3D; new ESRI.ArcGIS.Geometry.Point (); </span><br><span class="line">    pPoint.PutCoords(e.mapX, e.mapY); </span><br><span class="line">    this.axMapControl1.CenterAt(pPoint); </span><br><span class="line">    this.axMapControl1.ActiveView.PartialRefresh(esriViewDrawPhase.esriViewGeography, null, null); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="布局视图与主视图的同步"><a href="#布局视图与主视图的同步" class="headerlink" title="布局视图与主视图的同步"></a>布局视图与主视图的同步</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#region 布局视图与同步</span><br><span class="line">        private void axMapControl1_OnAfterScreenDraw(object sender, IMapControlEvents2_OnAfterScreenDrawEvent e)</span><br><span class="line">        &#123;</span><br><span class="line">            IActiveView pActiveView &#x3D; (IActiveView)this.axPageLayoutControl1.ActiveView.FocusMap;</span><br><span class="line">            IDisplayTransformation displayTransformation &#x3D; pActiveView.ScreenDisplay.DisplayTransformation;</span><br><span class="line">            displayTransformation.VisibleBounds &#x3D; this.axMapControl1.Extent;</span><br><span class="line">            axPageLayoutControl1.ActiveView.Refresh();</span><br><span class="line">            &#x2F;&#x2F;布局视图与数据视图的同步</span><br><span class="line">            IObjectCopy pObjectCopy &#x3D; new ObjectCopy() as IObjectCopy;</span><br><span class="line">            object copyFromMap &#x3D; this.axMapControl1.Map;</span><br><span class="line">            object copiedMap &#x3D; pObjectCopy.Copy(copyFromMap);&#x2F;&#x2F;复制地图到copiedMap中</span><br><span class="line">            object copyToMap &#x3D; axPageLayoutControl1.ActiveView.FocusMap;</span><br><span class="line">            pObjectCopy.Overwrite(copiedMap, ref copyToMap); &#x2F;&#x2F;复制地图</span><br><span class="line">            axPageLayoutControl1.ActiveView.Refresh();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">#endregion</span><br></pre></td></tr></table></figure>

<h6 id="ArcMap中的符号选择器"><a href="#ArcMap中的符号选择器" class="headerlink" title="ArcMap中的符号选择器"></a>ArcMap中的符号选择器</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#region 调用ArcMap中的符号选择器</span><br><span class="line">        private void axTOCControl_OnDoubleClick(object sender, ITOCControlEvents_OnDoubleClickEvent e)</span><br><span class="line">        &#123;</span><br><span class="line">            esriTOCControlItem toccItem &#x3D; esriTOCControlItem.esriTOCControlItemNone;</span><br><span class="line">            ILayer iLayer &#x3D; null;</span><br><span class="line">            IBasicMap iBasicMap &#x3D; null;</span><br><span class="line">            object unk &#x3D; null;</span><br><span class="line">            object data &#x3D; null;</span><br><span class="line"></span><br><span class="line">            if(e.button &#x3D;&#x3D;1)</span><br><span class="line">            &#123;</span><br><span class="line">                axTOCControl.HitTest(e.x, e.y, ref toccItem, ref iBasicMap, ref iLayer, ref unk, ref data);</span><br><span class="line">                if (toccItem &#x3D;&#x3D; esriTOCControlItem.esriTOCControlItemLegendClass) </span><br><span class="line">                &#123;</span><br><span class="line">                    ESRI.ArcGIS.Carto.ILegendClass pLC &#x3D; new LegendClass();</span><br><span class="line">                    ESRI.ArcGIS.Carto.ILegendGroup pLG &#x3D; new LegendGroup();</span><br><span class="line">                    if (unk is ILegendGroup)</span><br><span class="line">                    &#123;</span><br><span class="line">                        pLG &#x3D; (ILegendGroup)unk;</span><br><span class="line">                    &#125;</span><br><span class="line">                    pLC &#x3D; pLG.get_Class((int)data);</span><br><span class="line">                    ISymbol pSym &#x3D; pLC.Symbol;</span><br><span class="line">                    ESRI.ArcGIS.DisplayUI.ISymbolSelector pSS &#x3D; new</span><br><span class="line">                    ESRI.ArcGIS.DisplayUI.SymbolSelector();</span><br><span class="line">                    bool bOK &#x3D; false;</span><br><span class="line">                    pSS.AddSymbol(pSym);</span><br><span class="line">                    bOK &#x3D; pSS.SelectSymbol(0);</span><br><span class="line">                    if (bOK)</span><br><span class="line">                    &#123;</span><br><span class="line">                        pLC.Symbol &#x3D; pSS.GetSymbolAt(0);</span><br><span class="line">                    &#125;</span><br><span class="line">                    this.mainMapControl.ActiveView.Refresh();</span><br><span class="line">                    this.mainMapControl.Refresh();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br></pre></td></tr></table></figure>

<h6 id="地图操作工具类OperateMap"><a href="#地图操作工具类OperateMap" class="headerlink" title="地图操作工具类OperateMap"></a>地图操作工具类OperateMap</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">using ESRI.ArcGIS.Carto;</span><br><span class="line">using ESRI.ArcGIS.Geodatabase;</span><br><span class="line">using ESRI.ArcGIS.Display;</span><br><span class="line">using ESRI.ArcGIS.esriSystem;</span><br><span class="line">using ESRI.ArcGIS.Geometry;</span><br><span class="line">using ESRI.ArcGIS.Controls;</span><br><span class="line">using System.Windows.Forms;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">#region 设置RGB</span><br><span class="line">public IRgbColor GetRgbColor(int intR, int intG, int intB)</span><br><span class="line">&#123;</span><br><span class="line">    IRgbColor pRgbColor &#x3D; null;</span><br><span class="line">    if (intR &lt; 0 || intR &gt; 255 || intG &lt; 0 || intG &gt; 255 || intB &lt; 0 || intB &gt; 255)</span><br><span class="line">    &#123;</span><br><span class="line">        return pRgbColor;</span><br><span class="line">    &#125;</span><br><span class="line">    pRgbColor &#x3D; new RgbColor();</span><br><span class="line">    pRgbColor.Red &#x3D; intR;</span><br><span class="line">    pRgbColor.Green &#x3D; intG;</span><br><span class="line">    pRgbColor.Blue &#x3D; intB;</span><br><span class="line">    return pRgbColor;</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br><span class="line"></span><br><span class="line">#region 获取地图要素类</span><br><span class="line">public void GetLstFeatCls(ILayer pLayer, ref List&lt;IFeatureClass&gt; _lstFeatCls)</span><br><span class="line">&#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        ILayer pLyr &#x3D; null;</span><br><span class="line">        ICompositeLayer pComLyr &#x3D; pLayer as ICompositeLayer;</span><br><span class="line">        if (pComLyr &#x3D;&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            IFeatureLayer pFeatLyr &#x3D; pLayer as IFeatureLayer;</span><br><span class="line">            if (!_lstFeatCls.Contains(pFeatLyr.FeatureClass))</span><br><span class="line">            &#123;</span><br><span class="line">                _lstFeatCls.Add(pFeatLyr.FeatureClass);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            for (int i &#x3D; 0; i &lt; pComLyr.Count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pLyr &#x3D; pComLyr.get_Layer(i);</span><br><span class="line">                GetLstFeatCls(pLyr, ref _lstFeatCls);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br><span class="line"></span><br><span class="line">#region 获取当前地图所有图层的要素类</span><br><span class="line">public List&lt;IFeatureClass&gt; GetLstFeatCls(IMap pMap)</span><br><span class="line">&#123;</span><br><span class="line">    List&lt;IFeatureClass&gt; _lstFeatCls &#x3D; null;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        ILayer pLayer &#x3D; null;</span><br><span class="line">        IFeatureLayer pFeatLyr &#x3D; null;</span><br><span class="line">        _lstFeatCls &#x3D; new List&lt;IFeatureClass&gt;();</span><br><span class="line">        for (int i &#x3D; 0; i &lt; pMap.LayerCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            pLayer &#x3D; pMap.get_Layer(i);</span><br><span class="line">            pFeatLyr &#x3D; pLayer as IFeatureLayer;</span><br><span class="line">            GetLstFeatCls(pLayer, ref _lstFeatCls);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    return _lstFeatCls;</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br><span class="line"></span><br><span class="line">#region 由名称获取图层</span><br><span class="line">public IFeatureLayer GetFeatLyrByName(ILayer pLayer, string sFeatLyrName)</span><br><span class="line">&#123;</span><br><span class="line">    ILayer pLyr &#x3D; null;</span><br><span class="line">    IFeatureLayer pFeatureLyr &#x3D; null;</span><br><span class="line">    IFeatureLayer pFeatLyr &#x3D; null;</span><br><span class="line">    ICompositeLayer pComLyr &#x3D; pLayer as ICompositeLayer;</span><br><span class="line">    if (pComLyr &#x3D;&#x3D; null)</span><br><span class="line">    &#123;</span><br><span class="line">        pFeatLyr &#x3D; pLayer as IFeatureLayer;</span><br><span class="line">        if (pFeatLyr.FeatureClass.AliasName &#x3D;&#x3D; sFeatLyrName)</span><br><span class="line">        &#123;</span><br><span class="line">            pFeatureLyr &#x3D; pFeatLyr;</span><br><span class="line">            return pFeatureLyr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; pComLyr.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            pLyr &#x3D; pComLyr.get_Layer(i);</span><br><span class="line">            GetFeatLyrByName(pLyr, sFeatLyrName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return pFeatureLyr;</span><br><span class="line">&#125; </span><br><span class="line">#endregion</span><br><span class="line"></span><br><span class="line">        #region 据图层名称获取图层</span><br><span class="line">        public IFeatureLayer GetFeatLyrByName(IMap pMap, string sFeatLyrName)</span><br><span class="line">&#123;</span><br><span class="line">    IFeatureLayer pFeatLyr &#x3D; null;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        ILayer pLayer &#x3D; null;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; pMap.LayerCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            pLayer &#x3D; pMap.get_Layer(i);</span><br><span class="line">            pFeatLyr &#x3D; GetFeatLyrByName(pLayer, sFeatLyrName);</span><br><span class="line">            if (pFeatLyr !&#x3D; null) break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception ex)&#123;&#125;</span><br><span class="line">    return pFeatLyr;</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br></pre></td></tr></table></figure>

<h6 id="状态栏信息的添加与实现"><a href="#状态栏信息的添加与实现" class="headerlink" title="状态栏信息的添加与实现"></a>状态栏信息的添加与实现</h6><p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5Cae03.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">private void axToolbarControl1_OnMouseMove(object sender, IToolbarControlEvents_OnMouseMoveEvent e)</span><br><span class="line">&#123;</span><br><span class="line">    int index &#x3D; this.axToolbarControl1.HitTest(e.x, e.y);</span><br><span class="line">    if (index !&#x3D; -1)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageLabel.Text &#x3D; axToolbarControl1.GetItem(index).Command.Message.ToString();</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        MessageLabel.Text &#x3D; &quot;就绪&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void axMapControl1_OnMouseMove(object sender, IMapControlEvents2_OnMouseMoveEvent e)</span><br><span class="line">&#123;</span><br><span class="line">    if (axMapControl1.LayerCount !&#x3D; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        ScaleLabel.Text &#x3D; &quot;比例尺 1: &quot;+(long)axMapControl1.MapScale;</span><br><span class="line">        CoordinateLanel.Text &#x3D; &quot;位置 X&#x3D; &quot; + e.mapX + &quot; Y &#x3D; &quot; + e.mapY + &quot; 单位：&quot; + axMapControl1.MapUnits.ToString().Substring(4);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h6 id="导出地图为JPG"><a href="#导出地图为JPG" class="headerlink" title="导出地图为JPG"></a>导出地图为JPG</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">private void 地图导出_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    ExportMapToImage();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void ExportMapToImage()</span><br><span class="line">&#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        SaveFileDialog pSaveDialog &#x3D; new SaveFileDialog();</span><br><span class="line">        pSaveDialog.FileName &#x3D; &quot;&quot;;</span><br><span class="line">        pSaveDialog.Filter &#x3D; &quot;JPG图片(*.JPG)|*.jpg|tif图片(*.tif)|*.tif|PDF文档(*.PDF)|*.pdf&quot;;</span><br><span class="line">        if (pSaveDialog.ShowDialog() &#x3D;&#x3D; DialogResult.OK)</span><br><span class="line">        &#123;</span><br><span class="line">            double iScreenDispalyResolution &#x3D; axMapControl1.ActiveView.ScreenDisplay.DisplayTransformation.Resolution;&#x2F;&#x2F; 获取屏幕分辨率的值</span><br><span class="line">            IExporter pExporter &#x3D; null;</span><br><span class="line">            if (pSaveDialog.FilterIndex &#x3D;&#x3D; 1)</span><br><span class="line">            &#123;</span><br><span class="line">                pExporter &#x3D; new JpegExporter() as IExporter;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (pSaveDialog.FilterIndex &#x3D;&#x3D; 2)</span><br><span class="line">            &#123;</span><br><span class="line">                pExporter &#x3D; new TiffExporter() as IExporter;</span><br><span class="line">            &#125;</span><br><span class="line">            else if (pSaveDialog.FilterIndex &#x3D;&#x3D; 3)</span><br><span class="line">            &#123;</span><br><span class="line">                pExporter &#x3D; new PDFExporter() as IExporter;</span><br><span class="line">            &#125;</span><br><span class="line">            pExporter.ExportFileName &#x3D; pSaveDialog.FileName;</span><br><span class="line">            pExporter.Resolution &#x3D; (short)iScreenDispalyResolution; &#x2F;&#x2F;分辨率</span><br><span class="line">            tagRECT deviceRect &#x3D; axMapControl1.ActiveView.ScreenDisplay.DisplayTransformation.get_DeviceFrame();</span><br><span class="line">            IEnvelope pDeviceEnvelope &#x3D; new Envelope() as IEnvelope;</span><br><span class="line">            pDeviceEnvelope.PutCoords(deviceRect.left, deviceRect.bottom, deviceRect.right, deviceRect.top);</span><br><span class="line">            pExporter.PixelBounds &#x3D; pDeviceEnvelope; &#x2F;&#x2F; 输出图片的范围</span><br><span class="line">            ITrackCancel pCancle &#x3D; new CancelTracker();&#x2F;&#x2F;可用ESC键取消操作</span><br><span class="line">            axMapControl1.ActiveView.Output(pExporter.StartExporting(), pExporter.Resolution, ref deviceRect, axMapControl1.ActiveView.Extent, pCancle);</span><br><span class="line">            Application.DoEvents();</span><br><span class="line">            pExporter.FinishExporting();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception Err)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(Err.Message, &quot;输出图片&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="空间查询"><a href="#空间查询" class="headerlink" title="空间查询"></a>空间查询</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">esriSpatialRelEnum.esriSpatialRelEnvelopeIntersects A的Envelope和B的Envelope相交</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelIndexIntersects  A与B 索引相交</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelTouches A与B 边界相接</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelOverlaps A 与B 相叠加</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelCrosses A与B 相交（两条线相较于一点，一条线和一个面相交，与其说相交，不如说空间上穿过）</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelWithin A在B内</span><br><span class="line">esriSpatialRelEnum.esriSpatialRelContains  A 包含B </span><br><span class="line">esriSpatialRelEnum.esriSpatialRelRelation  A 与 B 空间关联</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;获取当前要素图层的几何信息</span><br><span class="line">currentFeatureLayer.FeatureClass.ShapeType</span><br><span class="line">&#x2F;&#x2F;如何判断当前要素图层的几何信息</span><br><span class="line">currentFeatureLayer.FeatureClass.ShapeType.Equals(esriGeometryType.esriGeometryPolygon)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ISpatialFilter spatialFilter &#x3D; new SpatialFilter();</span><br><span class="line">spatialFilter.Geometry &#x3D; pFeature.Shape as IGeometry;&#x2F;&#x2F;源几何图形对象</span><br><span class="line">spatialFilter.SpatialRel &#x3D; esriSpatialRelEnum.esriSpatialRelContains;</span><br><span class="line">IFeatureSelection featureSelection &#x3D; pointFeatureLayer as IFeatureSelection;&#x2F;&#x2F;目标图层</span><br><span class="line">featureSelection.SelectFeatures((IQueryFilter)spatialFilter, esriSelectionResultEnum.esriSelectionResultNew, false);</span><br><span class="line">&#x2F;&#x2F; 获取选中集对象</span><br><span class="line">ISelectionSet pSelectionSet &#x3D; featureSelection.SelectionSet;</span><br></pre></td></tr></table></figure>

<h6 id="地图选择集"><a href="#地图选择集" class="headerlink" title="地图选择集"></a>地图选择集</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;MainForm.cs</span><br><span class="line">private void ToolStripMenuItemMapSelection_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;新创建地图选择集窗体</span><br><span class="line">    FormSelection formSelection &#x3D; new FormSelection();</span><br><span class="line">    &#x2F;&#x2F;将当前主窗体中MapControl控件中的Map对象赋值给FormSelection窗体的CurrentMap属性</span><br><span class="line">    formSelection.CurrentMap &#x3D; axMapControl.Map;</span><br><span class="line">    &#x2F;&#x2F;显示地图选择集窗体</span><br><span class="line">    formSelection.Show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5Cae04.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;FormSelection.cs</span><br><span class="line">&#x2F;&#x2F;using ESRI.ArcGIS.Carto;</span><br><span class="line">&#x2F;&#x2F;using ESRI.ArcGIS.Geodatabase;</span><br><span class="line"></span><br><span class="line">private IMap currentMap;    &#x2F;&#x2F;当前MapControl控件中的Map对象</span><br><span class="line">private IFeatureLayer currentFeatureLayer; &#x2F;&#x2F;设置临时类变量来使用IFeatureLayer接口的当前图层对象</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; 获得当前MapControl控件中的Map对象。</span><br><span class="line">public IMap CurrentMap</span><br><span class="line">        &#123;</span><br><span class="line">            set</span><br><span class="line">            &#123;</span><br><span class="line">                currentMap &#x3D; value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;在窗体加载时执行本函数，加载所有具有选择要素的图层</span><br><span class="line">        private void FormSelection_Load(object sender, EventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            IFeatureLayer featureLayer; &#x2F;&#x2F;设置临时变量存储当前矢量图层</span><br><span class="line">            string layerName;   &#x2F;&#x2F;设置临时变量存储当前图层的名称</span><br><span class="line">            TreeNode treeNode;  &#x2F;&#x2F;设置临时变量存储当前树节点的信息</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;对Map中的每个图层进行判断并加载图层名称</span><br><span class="line">            for (int i &#x3D; 0; i &lt; currentMap.LayerCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;如果该图层为图层组类型，则分别对所包含的每个图层进行操作</span><br><span class="line">                if (currentMap.get_Layer(i) is GroupLayer)</span><br><span class="line">                &#123;</span><br><span class="line">                    &#x2F;&#x2F;使用ICompositeLayer接口进行遍历操作</span><br><span class="line">                    ICompositeLayer compositeLayer &#x3D; currentMap.get_Layer(i) as ICompositeLayer;</span><br><span class="line">                    for (int j &#x3D; 0; j &lt; compositeLayer.Count; j++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        &#x2F;&#x2F;得到图层的名称</span><br><span class="line">                        layerName &#x3D; compositeLayer.get_Layer(j).Name;</span><br><span class="line">                        &#x2F;&#x2F;得到矢量图层对象的IFeatureLayer接口</span><br><span class="line">                        featureLayer &#x3D; (IFeatureLayer)compositeLayer.get_Layer(j);</span><br><span class="line">                        &#x2F;&#x2F;如果该图层选择集中的要素不为空，则在TreeView控件中添加一个树节点</span><br><span class="line">                        if (((IFeatureSelection)featureLayer).SelectionSet.Count &gt; 0)</span><br><span class="line">                        &#123;</span><br><span class="line">                            &#x2F;&#x2F;新建一个树节点，将图层名称作为树节点的名称</span><br><span class="line">                            treeNode &#x3D; new TreeNode(layerName);</span><br><span class="line">                            &#x2F;&#x2F;利用树节点的Tag属性，存储当前图层的IFeatureLayer接口信息</span><br><span class="line">                            treeNode.Tag &#x3D; featureLayer;</span><br><span class="line">                            &#x2F;&#x2F;将新建的树节点添加到TreeView控件中的根节点下</span><br><span class="line">                            treeViewLayers.TopNode.Nodes.Add(treeNode);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                &#x2F;&#x2F;如果图层不是图层组类型，则同样在TreeView控件中的根节点下添加节点</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    layerName &#x3D; currentMap.get_Layer(i).Name;</span><br><span class="line">                    featureLayer &#x3D; (IFeatureLayer)currentMap.get_Layer(i);</span><br><span class="line">                    if (((IFeatureSelection)featureLayer).SelectionSet.Count &gt; 0)</span><br><span class="line">                    &#123;</span><br><span class="line">                        treeNode &#x3D; new TreeNode(layerName);</span><br><span class="line">                        treeNode.Tag &#x3D; featureLayer;</span><br><span class="line">                        treeViewLayers.TopNode.Nodes.Add(treeNode);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;添加完节点后将根节点展开以显示所有的图层</span><br><span class="line">            treeViewLayers.TopNode.Expand();</span><br><span class="line">            &#x2F;&#x2F;通过IMap接口的SelectionCount属性可以获取被选择要素的数量</span><br><span class="line">            labelMapSelectionCount.Text &#x3D; &quot;当前地图共选择了 &quot; + currentMap.SelectionCount + &quot; 个要素。&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;在图层被选中时执行本函数，完成该图层所有选中要素的列表</span><br><span class="line">private void treeView_NodeMouseClick(object sender, TreeNodeMouseClickEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    try</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;首先清空DataGridView中的行和列</span><br><span class="line">        dataGridView.Columns.Clear();</span><br><span class="line">        dataGridView.Rows.Clear();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;通过树节点的Tag属性获取以该节点名称命名的矢量图层</span><br><span class="line">        currentFeatureLayer &#x3D; e.Node.Tag as IFeatureLayer;</span><br><span class="line">        &#x2F;&#x2F;通过接口转换，使用IFeatureSelection接口获取图层的选择集</span><br><span class="line">        IFeatureSelection featureSelection &#x3D; currentFeatureLayer as IFeatureSelection;</span><br><span class="line">        &#x2F;&#x2F;通过ISelectionSet接口获取被选择的要素集合</span><br><span class="line">        ISelectionSet selectionSet &#x3D; featureSelection.SelectionSet;</span><br><span class="line">        &#x2F;&#x2F;通过ISelectionSet接口的Count属性可以获取被选择要素的数量</span><br><span class="line">        labelLayerSelectionCount.Text &#x3D; &quot;当前图层选择了 &quot; + selectionSet.Count + &quot; 个要素。&quot;;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;对当前图层要素的属性字段进行遍历，从而建立DataGridView中的列</span><br><span class="line">        &#x2F;&#x2F;获取所有的属性字段</span><br><span class="line">        IFields fields &#x3D; currentFeatureLayer.FeatureClass.Fields;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; fields.FieldCount; i++)</span><br><span class="line">        &#123; </span><br><span class="line">            &#x2F;&#x2F;通过遍历添加列，使用字段的AliasName作为DataGridView中显示的列名</span><br><span class="line">            dataGridView.Columns.Add(fields.get_Field(i).Name, fields.get_Field(i).AliasName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;对选择集进行遍历，从而建立DataGridView中的行</span><br><span class="line">        &#x2F;&#x2F;定义ICursor接口的游标以遍历整个选择集</span><br><span class="line">        ICursor cursor;</span><br><span class="line">        &#x2F;&#x2F;使用ISelectionSet接口的Search方法，使用null作为查询过滤器，cursor作为返回值获取整个选择集</span><br><span class="line">        selectionSet.Search(null, false, out cursor);</span><br><span class="line">        &#x2F;&#x2F;进行接口转换，使用IFeatureCursor接口来获取选择集中的每个要素</span><br><span class="line">        IFeatureCursor featureCursor &#x3D; cursor as IFeatureCursor;</span><br><span class="line">        &#x2F;&#x2F;获取IFeature接口的游标中的第一个元素</span><br><span class="line">        IFeature feature &#x3D; featureCursor.NextFeature();</span><br><span class="line">        &#x2F;&#x2F;定义string类型的数组，以添加DataGridView中每一行的数据</span><br><span class="line">        string[] strs;</span><br><span class="line">        &#x2F;&#x2F;当游标不为空时</span><br><span class="line">        while (feature !&#x3D; null)</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F;string数组的大小为字段的个数</span><br><span class="line">            strs &#x3D; new string[fields.FieldCount];</span><br><span class="line">            &#x2F;&#x2F;对字段进行遍历</span><br><span class="line">            for (int i &#x3D; 0; i &lt; fields.FieldCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                &#x2F;&#x2F;将当前要素的每个字段值放在数组的相应位置</span><br><span class="line">                strs[i] &#x3D; feature.get_Value(i).ToString();</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;在DataGridView中添加一行的数据</span><br><span class="line">            dataGridView.Rows.Add(strs);</span><br><span class="line">            &#x2F;&#x2F;移动游标到下一个要素</span><br><span class="line">            feature &#x3D; featureCursor.NextFeature();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    catch &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;在列表中点击某一行时发生，将主窗体的地图定位到该行所表示的要素范围</span><br><span class="line">private void dataGridView_CellClick(object sender, DataGridViewCellEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    if (e.RowIndex !&#x3D; -1)</span><br><span class="line">    &#123;</span><br><span class="line">        &#x2F;&#x2F;获取当前所点击的行</span><br><span class="line">        DataGridViewRow row &#x3D; dataGridView.Rows[e.RowIndex];</span><br><span class="line">        &#x2F;&#x2F;每行的第一列是要素的ObjectID，获取该信息</span><br><span class="line">        int objectID &#x3D; Convert.ToInt32(row.Cells[0].Value);</span><br><span class="line">        &#x2F;&#x2F;使用IFeatureClass接口的GetFeature方法根据ObjectID获取该要素</span><br><span class="line">        IFeature feature &#x3D; currentFeatureLayer.FeatureClass.GetFeature(objectID);</span><br><span class="line">        &#x2F;&#x2F;定义新的IEnvelope接口对象获取该要素的空间范围</span><br><span class="line">        ESRI.ArcGIS.Geometry.IEnvelope outEnvelope &#x3D; new ESRI.ArcGIS.Geometry.EnvelopeClass();</span><br><span class="line">        &#x2F;&#x2F;通过IGeometry接口的QueryEnvelope方法获取要素的空间范围</span><br><span class="line">        feature.Shape.QueryEnvelope(outEnvelope);</span><br><span class="line">        &#x2F;&#x2F;将主窗体地图的当前可视范围定义为要素的空间范围，并刷新地图</span><br><span class="line">        IActiveView activeView &#x3D; currentMap as IActiveView;</span><br><span class="line">        activeView.Extent &#x3D; outEnvelope;</span><br><span class="line">        activeView.Refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="属性统计"><a href="#属性统计" class="headerlink" title="属性统计"></a>属性统计</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;当选择统计字段发生变化时触发事件，执行本函数，完成统计分析操作</span><br><span class="line">private void comboBoxFields_SelectedIndexChanged(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    &#x2F;&#x2F;定义及新建IDataStatistics接口的对象进行字段统计</span><br><span class="line">    IDataStatistics dataStatistics &#x3D; new DataStatisticsClass();</span><br><span class="line">    &#x2F;&#x2F;获取需要统计的字段（String类型的）</span><br><span class="line">    dataStatistics.Field &#x3D; comboBoxFields.SelectedItem.ToString();</span><br><span class="line">    &#x2F;&#x2F;将当前矢量图层对象进行接口转换以进行选择集操作</span><br><span class="line">    IFeatureLayer featureSelection &#x3D; currentFeatureLayer as IFeatureLayer;</span><br><span class="line">    &#x2F;&#x2F;定义选择集的游标</span><br><span class="line">    ICursor cursor &#x3D; null;</span><br><span class="line">    &#x2F;&#x2F;使用null参数的Search方法获取整个选择集中的要素，得到相应的游标</span><br><span class="line">    cursor &#x3D; featureSelection.Search(null, false) as ICursor; </span><br><span class="line">    &#x2F;&#x2F;将该游标赋值给IDataStatistics接口对象的游标</span><br><span class="line">    dataStatistics.Cursor &#x3D; cursor;</span><br><span class="line">    &#x2F;&#x2F;执行统计</span><br><span class="line">    IStatisticsResults statisticsResults &#x3D; dataStatistics.Statistics;</span><br><span class="line">    &#x2F;&#x2F;定义StringBuilder对象进行字符串的操作</span><br><span class="line">    StringBuilder stringBuilder &#x3D; new StringBuilder();</span><br><span class="line">    &#x2F;&#x2F;以下语句依次增加各类统计结果</span><br><span class="line">    stringBuilder.AppendLine(&quot;统计总数： &quot; + statisticsResults.Count.ToString() + &quot;\n&quot;);</span><br><span class="line">    stringBuilder.AppendLine(&quot;最小值：&quot; + statisticsResults.Minimum.ToString() + &quot;\n&quot;);</span><br><span class="line">    stringBuilder.AppendLine(&quot;最大值：&quot; + statisticsResults.Maximum.ToString() + &quot;\n&quot;);</span><br><span class="line">    stringBuilder.AppendLine(&quot;总计： &quot; + statisticsResults.Sum.ToString() + &quot;\n&quot;);</span><br><span class="line">    stringBuilder.AppendLine(&quot;平均值： &quot; + statisticsResults.Mean.ToString() + &quot;\n&quot;);</span><br><span class="line">    stringBuilder.AppendLine(&quot;标准差： &quot; + statisticsResults.StandardDeviation.ToString());</span><br><span class="line">    &#x2F;&#x2F;将统计结果显示在窗体（标签）中</span><br><span class="line">    labelStatisticsResult.Text &#x3D; stringBuilder.ToString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="地图标注TextElement"><a href="#地图标注TextElement" class="headerlink" title="地图标注TextElement"></a>地图标注TextElement</h6><p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5Cae05.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">private frmTextElement frmTextElement &#x3D; null;&#x2F;&#x2F;定义标注窗体</span><br><span class="line">private OperateMap m_OperateMap &#x3D; null;&#x2F;&#x2F;地图操作工具类（需要在load事件里进行实例化）</span><br><span class="line">#region TextElement标注</span><br><span class="line">private void txtElement_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		if (frmTextElement &#x3D;&#x3D; null || frmTextElement.IsDisposed)</span><br><span class="line">		&#123;</span><br><span class="line">			frmTextElement &#x3D; new frmTextElement();</span><br><span class="line">			frmTextElement.TextElement +&#x3D; new frmTextElement.TextElementLabelEventHandler(frmTextElement_TextElement);</span><br><span class="line">		&#125;</span><br><span class="line">		frmTextElement.Map &#x3D; mainMapControl.Map;</span><br><span class="line">		frmTextElement.InitUI();</span><br><span class="line">		frmTextElement.ShowDialog();</span><br><span class="line">	&#125;</span><br><span class="line">	catch &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">void frmTextElement_TextElement(string sFeatClsName, string sFieldName)</span><br><span class="line">&#123;</span><br><span class="line">	IFeatureLayer pFeatLyr &#x3D; m_OperateMap.GetFeatLyrByName(mainMapControl.Map, sFeatClsName);</span><br><span class="line">	TextElementLabel(pFeatLyr, sFieldName);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void TextElementLabel(IFeatureLayer pFeatLyr, string sFieldName)</span><br><span class="line">&#123;</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		IMap pMap &#x3D; mainMapControl.Map;</span><br><span class="line">		&#x2F;&#x2F;获得图层所有要素</span><br><span class="line">		IFeatureClass pFeatureClass &#x3D; pFeatLyr.FeatureClass;</span><br><span class="line">		IFeatureCursor pFeatCursor &#x3D; pFeatureClass.Search(null, true);</span><br><span class="line">		IFeature pFeature &#x3D; pFeatCursor.NextFeature();</span><br><span class="line">		while (pFeature !&#x3D; null)</span><br><span class="line">		&#123;</span><br><span class="line">			IFields pFields &#x3D; pFeature.Fields;</span><br><span class="line">			&#x2F;&#x2F;找出标注字段的索引号</span><br><span class="line">			int index &#x3D; pFields.FindField(sFieldName);</span><br><span class="line">			&#x2F;&#x2F;得到要素的Envelope</span><br><span class="line">			IEnvelope pEnve &#x3D; pFeature.Extent;</span><br><span class="line">			IPoint pPoint &#x3D; new ESRI.ArcGIS.Geometry.Point();</span><br><span class="line">			pPoint.PutCoords(pEnve.XMin + pEnve.Width &#x2F; 2, pEnve.YMin + pEnve.Height &#x2F; 2);</span><br><span class="line">			&#x2F;&#x2F;新建字体对象</span><br><span class="line">			stdole.IFontDisp pFont;</span><br><span class="line">			pFont &#x3D; new stdole.StdFontClass() as stdole.IFontDisp;</span><br><span class="line">			pFont.Name &#x3D; &quot;微软雅黑&quot;;</span><br><span class="line">			&#x2F;&#x2F;产生一个文本符号</span><br><span class="line">			ITextSymbol pTextSymbol &#x3D; new TextSymbol();</span><br><span class="line">			&#x2F;&#x2F;设置文本符号的大小</span><br><span class="line">			pTextSymbol.Size &#x3D; 20;</span><br><span class="line">			pTextSymbol.Font &#x3D; pFont;</span><br><span class="line">			pTextSymbol.Color &#x3D; m_OperateMap.GetRgbColor(255, 0, 0);</span><br><span class="line">			&#x2F;&#x2F;产生一个文本对象</span><br><span class="line">			ITextElement pTextElement &#x3D; new TextElement() as ITextElement;</span><br><span class="line">			pTextElement.Text &#x3D; pFeature.get_Value(index).ToString();</span><br><span class="line">			pTextElement.ScaleText &#x3D; true;</span><br><span class="line">			pTextElement.Symbol &#x3D; pTextSymbol;</span><br><span class="line">			IElement pElement &#x3D; pTextElement as IElement;</span><br><span class="line">			pElement.Geometry &#x3D; pPoint;</span><br><span class="line">			IActiveView pActiveView &#x3D; pMap as IActiveView;</span><br><span class="line">			IGraphicsContainer pGraphicsContainer &#x3D; pMap as IGraphicsContainer;</span><br><span class="line">			&#x2F;&#x2F;添加元素</span><br><span class="line">			pGraphicsContainer.AddElement(pElement, 0);</span><br><span class="line">			pActiveView.PartialRefresh(esriViewDrawPhase.esriViewGraphics, null, null);</span><br><span class="line">			pPoint &#x3D; null;</span><br><span class="line">			pElement &#x3D; null;</span><br><span class="line">			pFeature &#x3D; pFeatCursor.NextFeature();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	catch&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">public partial class frmTextElement : Form</span><br><span class="line">&#123;</span><br><span class="line">	List&lt;IFeatureClass&gt; _lstFeatCls &#x3D; null;</span><br><span class="line">	public delegate void TextElementLabelEventHandler(string sFeatClsName, string sFieldName);</span><br><span class="line">	public event TextElementLabelEventHandler TextElement &#x3D; null;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public frmTextElement()</span><br><span class="line">	&#123;</span><br><span class="line">		InitializeComponent();</span><br><span class="line">	&#125;</span><br><span class="line">	private IMap _map;</span><br><span class="line">	public IMap Map</span><br><span class="line">	&#123;</span><br><span class="line">		get &#123; return _map; &#125;</span><br><span class="line">		set &#123; _map &#x3D; value; &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void InitUI()</span><br><span class="line">	&#123;</span><br><span class="line">		string sClsName &#x3D; string.Empty;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;          </span><br><span class="line">		OperateMap _OperateMap &#x3D; new OperateMap();</span><br><span class="line">		_lstFeatCls &#x3D; _OperateMap.GetLstFeatCls(_map);</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			sClsName &#x3D; pFeatCls.AliasName;</span><br><span class="line">			if (!cmbSelLyr.Items.Contains(sClsName))</span><br><span class="line">			&#123;</span><br><span class="line">				cmbSelLyr.Items.Add(sClsName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F;显示第一个可以选择的图层</span><br><span class="line">		if (cmbSelLyr.Items.Count &gt; 0)</span><br><span class="line">		&#123;</span><br><span class="line">			cmbSelLyr.SelectedIndex &#x3D; 0;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private IFeatureClass GetFeatClsByName(string sFeatClsName)</span><br><span class="line">	&#123;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			if (pFeatCls.AliasName &#x3D;&#x3D; sFeatClsName)</span><br><span class="line">			&#123;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return pFeatCls;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	private bool check()</span><br><span class="line">	&#123;</span><br><span class="line">		if (cmbSelLyr.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;请选择注记图层！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if (cmbSelField.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;请选择注记字段！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void cmbSelLyr_SelectedIndexChanged(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		IField pField &#x3D; null;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; GetFeatClsByName(cmbSelLyr.SelectedItem.ToString());</span><br><span class="line">		for (int i &#x3D; 0; i &lt; pFeatCls.Fields.FieldCount; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pField &#x3D; pFeatCls.Fields.get_Field(i);</span><br><span class="line">			if (pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeDouble ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeInteger ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSingle ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSmallInteger||</span><br><span class="line">				pField.Type&#x3D;&#x3D;esriFieldType.esriFieldTypeString||</span><br><span class="line">				 pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeOID)</span><br><span class="line">			&#123;</span><br><span class="line">				if (!cmbSelField.Items.Contains(pField.Name))</span><br><span class="line">				&#123;</span><br><span class="line">					cmbSelField.Items.Add(pField.Name);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;      </span><br><span class="line">	private void btnOK_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F;检查是否符合标注条件，如果不符合拒绝执行</span><br><span class="line">		if (!check()) return;</span><br><span class="line"></span><br><span class="line">		TextElement(cmbSelLyr.SelectedItem.ToString(), cmbSelField.SelectedItem.ToString());</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		cmbSelLyr.Items.Clear();</span><br><span class="line">		cmbSelLyr.Text &#x3D; &quot;&quot;;</span><br><span class="line">		Close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="唯一值符号化"><a href="#唯一值符号化" class="headerlink" title="唯一值符号化"></a>唯一值符号化</h6><p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5Cae06.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;MainForm.cs</span><br><span class="line">private frmUniqueValueRender frmUniqueValueRen &#x3D; null;</span><br><span class="line">private OperateMap m_OperateMap &#x3D; null;&#x2F;&#x2F;地图操作工具类（需要在load事件里进行实例化）</span><br><span class="line"></span><br><span class="line">#region 唯一值单字段 </span><br><span class="line">	private void UniqueValue_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		try</span><br><span class="line">		&#123;</span><br><span class="line">			if (frmUniqueValueRen &#x3D;&#x3D; null || frmUniqueValueRen.IsDisposed)</span><br><span class="line">			&#123;</span><br><span class="line">				frmUniqueValueRen &#x3D; new frmUniqueValueRender();</span><br><span class="line">				frmUniqueValueRen.UniqueValueRender +&#x3D; new frmUniqueValueRender.UniqueValueRenderEventHandler(frmUniqueValueRen_UniqueValueRender);</span><br><span class="line">			&#125;</span><br><span class="line">			frmUniqueValueRen.Map &#x3D; mainMapControl.Map;</span><br><span class="line">			frmUniqueValueRen.InitUI();</span><br><span class="line">			frmUniqueValueRen.ShowDialog();</span><br><span class="line">		&#125;</span><br><span class="line">		catch &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	void frmUniqueValueRen_UniqueValueRender(string sFeatClsName, string sFieldName)</span><br><span class="line">	&#123;</span><br><span class="line">		IFeatureLayer pFeatLyr &#x3D; m_OperateMap.GetFeatLyrByName(mainMapControl.Map, sFeatClsName);</span><br><span class="line">		UniqueValueRenderer(pFeatLyr, sFieldName);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	private void UniqueValueRenderer(IFeatureLayer pFeatLyr, string sFieldName)</span><br><span class="line">	&#123;</span><br><span class="line">		try</span><br><span class="line">		&#123;</span><br><span class="line">			IGeoFeatureLayer pGeoFeatLyr &#x3D; pFeatLyr as IGeoFeatureLayer;</span><br><span class="line">			ITable pTable &#x3D; pFeatLyr as ITable;</span><br><span class="line">			IUniqueValueRenderer pUniqueValueRender &#x3D; new UniqueValueRenderer();</span><br><span class="line"></span><br><span class="line">			int intFieldNumber &#x3D; pTable.FindField(sFieldName);</span><br><span class="line">			pUniqueValueRender.FieldCount &#x3D; 1;&#x2F;&#x2F;设置唯一值符号化的关键字段为一个</span><br><span class="line">			pUniqueValueRender.set_Field(0, sFieldName);&#x2F;&#x2F;设置唯一值符号化的第一个关键字段</span><br><span class="line"></span><br><span class="line">			IRandomColorRamp pRandColorRamp &#x3D; new RandomColorRamp();</span><br><span class="line">			pRandColorRamp.StartHue &#x3D; 0;</span><br><span class="line">			pRandColorRamp.MinValue &#x3D; 0;</span><br><span class="line">			pRandColorRamp.MinSaturation &#x3D; 15;</span><br><span class="line">			pRandColorRamp.EndHue &#x3D; 360;</span><br><span class="line">			pRandColorRamp.MaxValue &#x3D; 100;</span><br><span class="line">			pRandColorRamp.MaxSaturation &#x3D; 30;</span><br><span class="line">			&#x2F;&#x2F;根据渲染字段的值的个数，设置一组随机颜色，如某一字段有5个值，则创建5个随机颜色与之匹配</span><br><span class="line">			IQueryFilter pQueryFilter &#x3D; new QueryFilter();</span><br><span class="line">			pRandColorRamp.Size &#x3D; pFeatLyr.FeatureClass.FeatureCount(pQueryFilter);</span><br><span class="line">			bool bSuccess &#x3D; false;</span><br><span class="line">			pRandColorRamp.CreateRamp(out bSuccess);</span><br><span class="line"></span><br><span class="line">			IEnumColors pEnumRamp &#x3D; pRandColorRamp.Colors;</span><br><span class="line">			IColor pNextUniqueColor &#x3D; null;</span><br><span class="line">			&#x2F;&#x2F;查询字段的值</span><br><span class="line">			pQueryFilter &#x3D; new QueryFilter();</span><br><span class="line">			pQueryFilter.AddField(sFieldName);</span><br><span class="line">			ICursor pCursor &#x3D; pTable.Search(pQueryFilter, true);</span><br><span class="line">			IRow pNextRow &#x3D; pCursor.NextRow();</span><br><span class="line">			object codeValue &#x3D; null;</span><br><span class="line">			IRowBuffer pNextRowBuffer &#x3D; null;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			while (pNextRow !&#x3D; null)</span><br><span class="line">			&#123;</span><br><span class="line">				pNextRowBuffer &#x3D; pNextRow as IRowBuffer;</span><br><span class="line">				codeValue &#x3D; pNextRowBuffer.get_Value(intFieldNumber);&#x2F;&#x2F;获取渲染字段的每一个值</span><br><span class="line"></span><br><span class="line">				pNextUniqueColor &#x3D; pEnumRamp.Next();</span><br><span class="line">				if (pNextUniqueColor &#x3D;&#x3D; null)</span><br><span class="line">				&#123;</span><br><span class="line">					pEnumRamp.Reset();</span><br><span class="line">					pNextUniqueColor &#x3D; pEnumRamp.Next();</span><br><span class="line">				&#125;</span><br><span class="line">				IFillSymbol pFillSymbol &#x3D; null;</span><br><span class="line">				ILineSymbol pLineSymbol;</span><br><span class="line">				IMarkerSymbol pMarkerSymbol;</span><br><span class="line">				switch (pGeoFeatLyr.FeatureClass.ShapeType)</span><br><span class="line">				&#123;</span><br><span class="line">					case esriGeometryType.esriGeometryPolygon:</span><br><span class="line">						&#123;</span><br><span class="line">							pFillSymbol &#x3D; new SimpleFillSymbol();</span><br><span class="line">							pFillSymbol.Color &#x3D; pNextUniqueColor;</span><br><span class="line">							pUniqueValueRender.AddValue(codeValue.ToString(), &quot;&quot;, pFillSymbol as ISymbol);&#x2F;&#x2F;添加渲染字段的值和渲染样式</span><br><span class="line">							pNextRow &#x3D; pCursor.NextRow();</span><br><span class="line">							break;</span><br><span class="line">						&#125;</span><br><span class="line">					case esriGeometryType.esriGeometryPolyline:</span><br><span class="line">						&#123;</span><br><span class="line">							pLineSymbol &#x3D; new SimpleLineSymbol();</span><br><span class="line">							pLineSymbol.Color &#x3D; pNextUniqueColor;</span><br><span class="line">							pUniqueValueRender.AddValue(codeValue.ToString(), &quot;&quot;, pLineSymbol as ISymbol);&#x2F;&#x2F;添加渲染字段的值和渲染样式</span><br><span class="line">							pNextRow &#x3D; pCursor.NextRow();</span><br><span class="line">							break;</span><br><span class="line">						&#125;</span><br><span class="line">					case esriGeometryType.esriGeometryPoint:</span><br><span class="line">						&#123;</span><br><span class="line">							pMarkerSymbol &#x3D; new SimpleMarkerSymbol();</span><br><span class="line">							pMarkerSymbol.Color &#x3D; pNextUniqueColor;</span><br><span class="line">							pUniqueValueRender.AddValue(codeValue.ToString(), &quot;&quot;, pMarkerSymbol as ISymbol);&#x2F;&#x2F;添加渲染字段的值和渲染样式</span><br><span class="line">							pNextRow &#x3D; pCursor.NextRow();</span><br><span class="line">							break;</span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			pGeoFeatLyr.Renderer &#x3D; pUniqueValueRender as IFeatureRenderer;</span><br><span class="line">			mainMapControl.Refresh();</span><br><span class="line">			mainTOCControl.Update();</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex)&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	#endregion</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">public partial class frmUniqueValueRender : Form</span><br><span class="line">&#123;</span><br><span class="line">	List&lt;IFeatureClass&gt; _lstFeatCls &#x3D; null;</span><br><span class="line">	public delegate void UniqueValueRenderEventHandler(string sFeatClsName, string sFieldName);</span><br><span class="line">	public event UniqueValueRenderEventHandler UniqueValueRender &#x3D; null;</span><br><span class="line">	public frmUniqueValueRender()</span><br><span class="line">	&#123;</span><br><span class="line">		InitializeComponent();</span><br><span class="line">	&#125;</span><br><span class="line">	private IMap _map;</span><br><span class="line">	public IMap Map</span><br><span class="line">	&#123;</span><br><span class="line">		get &#123; return _map; &#125;</span><br><span class="line">		set &#123; _map &#x3D; value; &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void InitUI()</span><br><span class="line">	&#123;</span><br><span class="line">		string sClsName &#x3D; string.Empty;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;          </span><br><span class="line">		OperateMap _OperateMap &#x3D; new OperateMap();</span><br><span class="line">		_lstFeatCls &#x3D; _OperateMap.GetLstFeatCls(_map);</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			sClsName &#x3D; pFeatCls.AliasName;</span><br><span class="line">			if (!cmbSelLyr.Items.Contains(sClsName))</span><br><span class="line">			&#123;</span><br><span class="line">				cmbSelLyr.Items.Add(sClsName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private IFeatureClass GetFeatClsByName(string sFeatClsName)</span><br><span class="line">	&#123;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			if (pFeatCls.AliasName &#x3D;&#x3D; sFeatClsName)</span><br><span class="line">			&#123;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return pFeatCls;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	private bool check()</span><br><span class="line">	&#123;</span><br><span class="line">		if (cmbSelLyr.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">		   MessageBox.Show(&quot;请选择符号化图层！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if (cmbSelField.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">		   MessageBox.Show(&quot;请选择符号化字段！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;      </span><br><span class="line">	private void cmbSelLyr_SelectedIndexChanged(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		IField pField &#x3D; null;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; GetFeatClsByName(cmbSelLyr.SelectedItem.ToString());</span><br><span class="line">		for (int i &#x3D; 0; i &lt; pFeatCls.Fields.FieldCount; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pField &#x3D; pFeatCls.Fields.get_Field(i);</span><br><span class="line">			if (pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeDouble ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeInteger ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSingle ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSmallInteger)</span><br><span class="line">			&#123;</span><br><span class="line">				if (!cmbSelField.Items.Contains(pField.Name))</span><br><span class="line">				&#123;</span><br><span class="line">					cmbSelField.Items.Add(pField.Name);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void btnOK_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		if (!check()) return;</span><br><span class="line">		UniqueValueRender(cmbSelLyr.SelectedItem.ToString(), cmbSelField.SelectedItem.ToString());</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelLyr.Items.Clear();</span><br><span class="line">		cmbSelLyr.Text &#x3D; &quot;&quot;;</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		Close();  </span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="分级色彩符号化"><a href="#分级色彩符号化" class="headerlink" title="分级色彩符号化"></a>分级色彩符号化</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;MainForm.cs</span><br><span class="line">private frmGraduatedcolors frmGraduatedcolors &#x3D; null;</span><br><span class="line">private OperateMap m_OperateMap &#x3D; null;&#x2F;&#x2F;地图操作工具类（需要在load事件里进行实例化）</span><br><span class="line"></span><br><span class="line">#region 分级色彩</span><br><span class="line">private void Graduatedcolor_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		if (frmGraduatedcolors &#x3D;&#x3D; null || frmGraduatedcolors.IsDisposed)</span><br><span class="line">		&#123;</span><br><span class="line">			frmGraduatedcolors &#x3D; new frmGraduatedcolors();</span><br><span class="line">			frmGraduatedcolors.Graduatedcolors +&#x3D; new frmGraduatedcolors.GraduatedcolorsEventHandler(frmGraduatedcolors_Graduatedcolors);</span><br><span class="line">		&#125;</span><br><span class="line">		frmGraduatedcolors.Map &#x3D; mainMapControl.Map;</span><br><span class="line">		frmGraduatedcolors.InitUI();</span><br><span class="line">		frmGraduatedcolors.ShowDialog();</span><br><span class="line">	&#125;</span><br><span class="line">	catch&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">void frmGraduatedcolors_Graduatedcolors(string sFeatClsName, string sFieldName, int numclasses)</span><br><span class="line">&#123;</span><br><span class="line">	IFeatureLayer pFeatLyr &#x3D; m_OperateMap.GetFeatLyrByName(mainMapControl.Map, sFeatClsName);</span><br><span class="line">	GraduatedColors(pFeatLyr, sFieldName, numclasses);</span><br><span class="line">&#125;</span><br><span class="line">public void GraduatedColors(IFeatureLayer pFeatLyr, string sFieldName, int numclasses)</span><br><span class="line">&#123;</span><br><span class="line">	IGeoFeatureLayer pGeoFeatureL &#x3D; pFeatLyr as IGeoFeatureLayer;</span><br><span class="line">	object dataFrequency;</span><br><span class="line">	object dataValues;</span><br><span class="line">	bool ok;</span><br><span class="line">	int breakIndex;</span><br><span class="line"></span><br><span class="line">	ITable pTable &#x3D; pGeoFeatureL.FeatureClass as ITable;</span><br><span class="line">	ITableHistogram pTableHistogram &#x3D; new BasicTableHistogram() as ITableHistogram;</span><br><span class="line">	IBasicHistogram pBasicHistogram &#x3D; (IBasicHistogram)pTableHistogram;</span><br><span class="line">	pTableHistogram.Field &#x3D; sFieldName;</span><br><span class="line">	pTableHistogram.Table &#x3D; pTable;</span><br><span class="line">	pBasicHistogram.GetHistogram(out dataValues, out dataFrequency);     &#x2F;&#x2F;获取渲染字段的值及其出现的频率</span><br><span class="line">	IClassifyGEN pClassify &#x3D; new EqualInterval();</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		pClassify.Classify(dataValues, dataFrequency, ref  numclasses);  &#x2F;&#x2F;根据获取字段的值和出现的频率对其进行等级划分 </span><br><span class="line">	&#125;</span><br><span class="line">	catch&#123;&#125;</span><br><span class="line">	&#x2F;&#x2F;返回一个数组</span><br><span class="line">	double[] Classes &#x3D; pClassify.ClassBreaks as double[];</span><br><span class="line">	int ClassesCount &#x3D; Classes.GetUpperBound(0);</span><br><span class="line">	IClassBreaksRenderer pClassBreaksRenderer &#x3D; new ClassBreaksRenderer();</span><br><span class="line">	pClassBreaksRenderer.Field &#x3D; sFieldName; &#x2F;&#x2F;设置分级字段</span><br><span class="line">	pClassBreaksRenderer.BreakCount &#x3D; ClassesCount; &#x2F;&#x2F;设置分级数目</span><br><span class="line">	pClassBreaksRenderer.SortClassesAscending &#x3D; true;&#x2F;&#x2F;分级后的图例是否按升级顺序排列</span><br><span class="line">	&#x2F;&#x2F;设置分级着色所需颜色带的起止颜色</span><br><span class="line">	IHsvColor pFromColor &#x3D; new HsvColor();</span><br><span class="line">	pFromColor.Hue &#x3D; 0;&#x2F;&#x2F;黄色</span><br><span class="line">	pFromColor.Saturation &#x3D; 50;</span><br><span class="line">	pFromColor.Value &#x3D; 96;</span><br><span class="line">	IHsvColor pToColor &#x3D; new HsvColor();</span><br><span class="line">	pToColor.Hue &#x3D; 80;</span><br><span class="line">	pToColor.Saturation &#x3D; 100;</span><br><span class="line">	pToColor.Value &#x3D; 96;</span><br><span class="line">	&#x2F;&#x2F;产生颜色带对象</span><br><span class="line">	IAlgorithmicColorRamp pAlgorithmicCR &#x3D; new AlgorithmicColorRamp();</span><br><span class="line">	pAlgorithmicCR.Algorithm &#x3D; esriColorRampAlgorithm.esriHSVAlgorithm;</span><br><span class="line">	pAlgorithmicCR.FromColor &#x3D; pFromColor;</span><br><span class="line">	pAlgorithmicCR.ToColor &#x3D; pToColor;</span><br><span class="line">	pAlgorithmicCR.Size &#x3D; ClassesCount;</span><br><span class="line">	pAlgorithmicCR.CreateRamp(out ok);</span><br><span class="line">	&#x2F;&#x2F;获得颜色</span><br><span class="line">	IEnumColors pEnumColors &#x3D; pAlgorithmicCR.Colors;</span><br><span class="line">	&#x2F;&#x2F;需要注意的是分级着色对象中的symbol和break的下标都是从0开始</span><br><span class="line">	for (breakIndex &#x3D; 0; breakIndex &lt;&#x3D; ClassesCount - 1; breakIndex++)</span><br><span class="line">	&#123;</span><br><span class="line">		IColor pColor &#x3D; pEnumColors.Next();</span><br><span class="line">		switch (pGeoFeatureL.FeatureClass.ShapeType)</span><br><span class="line">		&#123;</span><br><span class="line">			case esriGeometryType.esriGeometryPolygon:</span><br><span class="line">				&#123;</span><br><span class="line">					ISimpleFillSymbol pSimpleFillS &#x3D; new SimpleFillSymbol();</span><br><span class="line">					pSimpleFillS.Color &#x3D; pColor;</span><br><span class="line">					pSimpleFillS.Style &#x3D; esriSimpleFillStyle.esriSFSSolid;</span><br><span class="line">					pClassBreaksRenderer.set_Symbol(breakIndex, (ISymbol)pSimpleFillS);&#x2F;&#x2F;设置填充符号</span><br><span class="line">					pClassBreaksRenderer.set_Break(breakIndex, Classes[breakIndex + 1]);&#x2F;&#x2F;设定每一分级的分级断点</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			case esriGeometryType.esriGeometryPolyline:</span><br><span class="line">				&#123;</span><br><span class="line">					ISimpleLineSymbol pSimpleLineSymbol &#x3D; new SimpleLineSymbol();</span><br><span class="line">					pSimpleLineSymbol.Color &#x3D; pColor;</span><br><span class="line">					pClassBreaksRenderer.set_Symbol(breakIndex, (ISymbol)pSimpleLineSymbol);</span><br><span class="line">					pClassBreaksRenderer.set_Break(breakIndex, Classes[breakIndex + 1]);</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			case esriGeometryType.esriGeometryPoint:</span><br><span class="line">				&#123;</span><br><span class="line">					ISimpleMarkerSymbol pSimpleMarkerSymbol &#x3D; new SimpleMarkerSymbol();</span><br><span class="line">					pSimpleMarkerSymbol.Color &#x3D; pColor;</span><br><span class="line">					pClassBreaksRenderer.set_Symbol(breakIndex, (ISymbol)pSimpleMarkerSymbol);&#x2F;&#x2F;设置填充符号</span><br><span class="line">					pClassBreaksRenderer.set_Break(breakIndex, Classes[breakIndex + 1]);&#x2F;&#x2F;设定每一分级的分级断点</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	pGeoFeatureL.Renderer &#x3D; (IFeatureRenderer)pClassBreaksRenderer;</span><br><span class="line">	mainMapControl.Refresh();</span><br><span class="line">	mainTOCControl.Update();</span><br><span class="line">	mainTOCControl.Refresh();</span><br><span class="line">&#125;</span><br><span class="line">#endregion</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5C%E5%88%86%E7%BA%A7%E9%A2%9C%E8%89%B2.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">public partial class frmGraduatedcolors : Form</span><br><span class="line">&#123;</span><br><span class="line">	List&lt;IFeatureClass&gt; _lstFeatCls &#x3D; null;</span><br><span class="line">	public delegate void GraduatedcolorsEventHandler(string sFeatClsName, string sFieldName, int intnumclassess);</span><br><span class="line">	public event GraduatedcolorsEventHandler Graduatedcolors &#x3D; null;</span><br><span class="line">	public frmGraduatedcolors()</span><br><span class="line">	&#123;</span><br><span class="line">		InitializeComponent();</span><br><span class="line">	&#125;</span><br><span class="line">	private IMap _map;</span><br><span class="line">	public IMap Map</span><br><span class="line">	&#123;</span><br><span class="line">		get &#123; return _map; &#125;</span><br><span class="line">		set &#123; _map &#x3D; value; &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public void InitUI()</span><br><span class="line">	&#123;</span><br><span class="line">		string sClsName &#x3D; string.Empty;</span><br><span class="line">		cmbSelLyr.Items.Clear();</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;         </span><br><span class="line">		OperateMap _OperateMap &#x3D; new OperateMap();</span><br><span class="line">		_lstFeatCls &#x3D; _OperateMap.GetLstFeatCls(_map);</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			sClsName &#x3D; pFeatCls.AliasName;</span><br><span class="line">			if (!cmbSelLyr.Items.Contains(sClsName))</span><br><span class="line">			&#123;</span><br><span class="line">				cmbSelLyr.Items.Add(sClsName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	private bool check()</span><br><span class="line">	&#123;</span><br><span class="line">		if (cmbSelLyr.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;请选择符号化图层！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if (cmbSelField.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;请选择符号化字段！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		if (cmbnumclasses.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;请选择颜色分级数目！&quot;, &quot;提示&quot;, MessageBoxButtons.OK, MessageBoxIcon.Information);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		return true;</span><br><span class="line">	&#125;</span><br><span class="line">	private IFeatureClass GetFeatClsByName(string sFeatClsName)</span><br><span class="line">	&#123;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; null;</span><br><span class="line">		for (int i &#x3D; 0; i &lt; _lstFeatCls.Count; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pFeatCls &#x3D; _lstFeatCls[i];</span><br><span class="line">			if (pFeatCls.AliasName &#x3D;&#x3D; sFeatClsName)</span><br><span class="line">			&#123;</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return pFeatCls;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void cmbSelLyr_SelectedIndexChanged(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		IField pField &#x3D; null;</span><br><span class="line">		IFeatureClass pFeatCls &#x3D; GetFeatClsByName(cmbSelLyr.SelectedItem.ToString());</span><br><span class="line">		for (int i &#x3D; 0; i &lt; pFeatCls.Fields.FieldCount; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			pField &#x3D; pFeatCls.Fields.get_Field(i);</span><br><span class="line">			if (pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeDouble ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeInteger ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSingle ||</span><br><span class="line">				pField.Type &#x3D;&#x3D; esriFieldType.esriFieldTypeSmallInteger)</span><br><span class="line">			&#123;</span><br><span class="line">				if (!cmbSelField.Items.Contains(pField.Name))</span><br><span class="line">				&#123;</span><br><span class="line">					cmbSelField.Items.Add(pField.Name);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;             </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void btnOk_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F;GraduatedColors</span><br><span class="line">		if (!check()) return;           </span><br><span class="line">		Graduatedcolors(cmbSelLyr.SelectedItem.ToString(), </span><br><span class="line">			cmbSelField.SelectedItem.ToString(), </span><br><span class="line">			Convert.ToInt32(cmbnumclasses.SelectedItem.ToString()));</span><br><span class="line">		cmbSelLyr.Items.Clear();</span><br><span class="line">		cmbSelField.Items.Clear();</span><br><span class="line">		cmbSelLyr.Text &#x3D; &quot;&quot;;</span><br><span class="line">		cmbSelField.Text &#x3D; &quot;&quot;;</span><br><span class="line">		cmbnumclasses.SelectedIndex &#x3D; -1;</span><br><span class="line">		Close();</span><br><span class="line">	&#125;</span><br><span class="line">	private void btncancel_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		Close();</span><br><span class="line">	&#125;                   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="将Excel数据源表转化为空间点数据"><a href="#将Excel数据源表转化为空间点数据" class="headerlink" title="将Excel数据源表转化为空间点数据"></a>将Excel数据源表转化为空间点数据</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;MainForm.cs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private void btnExcelXYToPoint_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    FrmXYToPoint pFrmXYToPoint &#x3D; new FrmXYToPoint();</span><br><span class="line">    pFrmXYToPoint.GetAxMapControl &#x3D; axMapControl1;</span><br><span class="line">    pFrmXYToPoint.GetAxTOCControl &#x3D; axTOCControl1;</span><br><span class="line">    pFrmXYToPoint.ShowDialog();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="C:%5CUsers%5Clen%5CDesktop%5C%E7%BC%96%E7%A8%8B%E6%96%87%E6%A1%A3%5Cimg%5CXY%E8%BD%AC%E7%82%B9.png" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;using  System.IO;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  System.Data.OleDb;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  System.Collections;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.Geodatabase;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.Geometry;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.esriSystem;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.DataSourcesFile;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.Carto;</span><br><span class="line">&#x2F;&#x2F;&#x2F;using  ESRI.ArcGIS.Controls;</span><br><span class="line"></span><br><span class="line">public partial class FrmXYToPoint : Form</span><br><span class="line">&#123;</span><br><span class="line">	private OleDbConnection m_conDBConnection;</span><br><span class="line">	public FrmXYToPoint()</span><br><span class="line">	&#123;</span><br><span class="line">		InitializeComponent();</span><br><span class="line">	&#125;</span><br><span class="line">   </span><br><span class="line">	private AxMapControl m_axMapControl;</span><br><span class="line">   &#x2F;&#x2F;&#x2F; 传递主窗体AxMapcontrol控件</span><br><span class="line">	public AxMapControl GetAxMapControl</span><br><span class="line">	&#123;</span><br><span class="line">		set &#123; m_axMapControl &#x3D; value; &#125;</span><br><span class="line">		get &#123; return m_axMapControl; &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private AxTOCControl m_axTOCControl;</span><br><span class="line">	&#x2F;&#x2F;&#x2F; 传递主窗体AxTOCControl控件</span><br><span class="line">	public AxTOCControl GetAxTOCControl</span><br><span class="line">	&#123;</span><br><span class="line">		set &#123; m_axTOCControl &#x3D; value; &#125;</span><br><span class="line">		get &#123; return m_axTOCControl; &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;&#x2F; 打开Excel操作</span><br><span class="line">	private void btnOpenExcel_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		OpenFileDialog OFD &#x3D; new OpenFileDialog();</span><br><span class="line">		OFD.Filter &#x3D; &quot;Excel数据|*.xls;*.xlsx&quot;;</span><br><span class="line">		if (OFD.ShowDialog(this) !&#x3D; DialogResult.OK)</span><br><span class="line">		&#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F;获取选择Excel路径</span><br><span class="line">		string strDBName &#x3D; OFD.FileName;</span><br><span class="line">		txtExcelPath.Text &#x3D; strDBName;</span><br><span class="line">		txtExcelPath.Tag &#x3D; OFD.FilterIndex;</span><br><span class="line">		&#x2F;&#x2F;构造连接Excel字符串</span><br><span class="line">		StringBuilder strConnect &#x3D; new StringBuilder();</span><br><span class="line">		string extension &#x3D; System.IO.Path.GetExtension(strDBName);</span><br><span class="line">		switch (extension)</span><br><span class="line">		&#123;</span><br><span class="line">			case &quot;.xls&quot;:</span><br><span class="line">				&#x2F;&#x2F;当为Excel03格式时</span><br><span class="line">				strConnect.Append(string.Format(&quot;Provider&#x3D;Microsoft.Jet.OLEDB.4.0;Data Source&#x3D;&#123;0&#125;;&quot;, strDBName));</span><br><span class="line">				strConnect.Append(&quot;Extended Properties&#x3D;&#39;Excel 8.0;HDR&#x3D;Yes;IMEX&#x3D;1;&#39;&quot;);</span><br><span class="line">				break;</span><br><span class="line">			case &quot;.xlsx&quot;:</span><br><span class="line">				&#x2F;&#x2F;当为Excel07格式时</span><br><span class="line">				strConnect.Append(string.Format(&quot;Provider&#x3D;Microsoft.ACE.OLEDB.12.0;Data Source&#x3D;&#123;0&#125;;&quot;, strDBName));</span><br><span class="line">				strConnect.Append(&quot;Extended Properties&#x3D;&#39;Excel 12.0;HDR&#x3D;Yes;IMEX&#x3D;1;&#39;&quot;);</span><br><span class="line">				break;</span><br><span class="line">			default:</span><br><span class="line">				break;</span><br><span class="line">		&#125;</span><br><span class="line">		if (strConnect.ToString() &#x3D;&#x3D; string.Empty)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;打开Excel格式不支持！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		cmbExcelSheets.Items.Clear();</span><br><span class="line">		m_conDBConnection &#x3D; new OleDbConnection();</span><br><span class="line">		m_conDBConnection.ConnectionString &#x3D; strConnect.ToString();</span><br><span class="line">		m_conDBConnection.Open();</span><br><span class="line">		&#x2F;&#x2F;获取Excel中sheet列表</span><br><span class="line">		DataTable dtTable &#x3D; m_conDBConnection.GetOleDbSchemaTable(System.Data.OleDb.OleDbSchemaGuid.Tables, new System.Object[] &#123; null, null, null, &quot;TABLE&quot; &#125;);</span><br><span class="line">		if (dtTable &#x3D;&#x3D; null)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;未能找到有效的Sheet表&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		&#x2F;&#x2F;将获取到的Sheet列表添加到【选择坐标数据表】下拉列表中           </span><br><span class="line">		foreach (System.Data.DataRow row in dtTable.Rows)</span><br><span class="line">		&#123;</span><br><span class="line">			string strTableName &#x3D; row[&quot;TABLE_NAME&quot;].ToString();</span><br><span class="line">			cmbExcelSheets.Items.Add(strTableName);</span><br><span class="line">		&#125;</span><br><span class="line">		cmbExcelSheets.SelectedIndex &#x3D; 0;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;&#x2F; 选择sheet表发生变化时，读取sheet表中列名</span><br><span class="line">	private void cmbExcelSheets_SelectedIndexChanged(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		this.cmbXField.Items.Clear();</span><br><span class="line">		this.cmbYField.Items.Clear();</span><br><span class="line">		&#x2F;&#x2F; 选择sheet表发生变化时，读取sheet表中列名加载到“成图X字段”和“成图Y字段”</span><br><span class="line">		&#x2F;&#x2F;下拉选择列表</span><br><span class="line">		string sheetTableName &#x3D; cmbExcelSheets.SelectedItem.ToString();</span><br><span class="line">		DataTable dt &#x3D; new DataTable();</span><br><span class="line">		&#x2F;&#x2F;读取前10条数据，返回数据结果DataTable</span><br><span class="line">	   dt&#x3D; QueryBySql(String.Format(&quot;select top 10 * from [&#123;0&#125;]&quot;, sheetTableName));</span><br><span class="line">		if(dt !&#x3D; null)</span><br><span class="line">		&#123;</span><br><span class="line">			&#x2F;&#x2F;通过遍历加载X Y字段下拉选择框</span><br><span class="line">			foreach (DataColumn column in dt.Columns)</span><br><span class="line">			&#123;</span><br><span class="line">				this.cmbXField.Items.Add(column.ColumnName);    </span><br><span class="line">				this.cmbYField.Items.Add(column.ColumnName);                 </span><br><span class="line">			&#125;</span><br><span class="line">			this.cmbXField.SelectedIndex &#x3D; 0;</span><br><span class="line">			this.cmbYField.SelectedIndex &#x3D; 0;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;&#x2F; sql查询返回table形式</span><br><span class="line">	private DataTable QueryBySql(string p_strSql)</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F;构造数据库操作变量，利用sql查询返回DataTable形式</span><br><span class="line">		OleDbCommand m_cmdCommand &#x3D; new OleDbCommand();</span><br><span class="line">		m_cmdCommand.Connection &#x3D; m_conDBConnection;</span><br><span class="line">		m_cmdCommand.CommandText &#x3D; p_strSql;</span><br><span class="line">		m_cmdCommand.CommandType &#x3D; CommandType.Text;</span><br><span class="line">		&#x2F;&#x2F;进行数据查询</span><br><span class="line">		using (OleDbDataAdapter m_dtrAdapter &#x3D; new OleDbDataAdapter(m_cmdCommand))</span><br><span class="line">		&#123;</span><br><span class="line">			DataSet objDs &#x3D; new DataSet();</span><br><span class="line">			m_dtrAdapter.Fill(objDs);</span><br><span class="line">			return objDs.Tables[0];</span><br><span class="line">		&#125;       </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;&#x2F; 将X Y坐标成图</span><br><span class="line">	private void btnConvert_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F;将X Y坐标成图，首先判定各设置条件是否完整</span><br><span class="line">		if (this.txtExcelPath.Text.Trim() &#x3D;&#x3D;string.Empty)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;坐标数据不能为空！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		if (this.cmbExcelSheets.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;未选择X Y坐标数据Sheet表！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		if (this.cmbXField.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;未选择成图X字段 ！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		if (this.cmbYField.SelectedIndex &#x3D;&#x3D; -1)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;未选择成图Y字段 ！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		if (this.cmbXField.SelectedItem.ToString() &#x3D;&#x3D;this.cmbYField.SelectedItem.ToString() )</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(&quot;成图X字段与成图Y字段不能相同 ！&quot;);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line">		try</span><br><span class="line">		&#123;</span><br><span class="line">			&#x2F;&#x2F;下面进行数据成图</span><br><span class="line">			string xFieldName &#x3D; this.cmbXField.SelectedItem.ToString();</span><br><span class="line">			string yFieldName &#x3D; this.cmbYField.SelectedItem.ToString();</span><br><span class="line">			string sheetTableName &#x3D; this.cmbExcelSheets.SelectedItem.ToString();</span><br><span class="line">			&#x2F;&#x2F;获得所有数据</span><br><span class="line">			DataTable dt &#x3D; QueryBySql(String.Format(&quot;select * from [&#123;0&#125;]&quot;, sheetTableName));</span><br><span class="line">			&#x2F;&#x2F;将DataTable转化为ITable</span><br><span class="line">			ITable pTable &#x3D; DataTableToITable(dt, xFieldName, yFieldName, @&quot;c:\dat\&quot;);</span><br><span class="line">			if (pTable &#x3D;&#x3D; null)</span><br><span class="line">			&#123;</span><br><span class="line">				MessageBox.Show(&quot;数据转换失败！没有将DataTable转化为ITable。&quot;);</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">			IFeatureClass pFeatureClass &#x3D; OpenXYData(pTable, &quot;X&quot;, &quot;Y&quot;, &quot;&quot;, new UnknownCoordinateSystem() as ISpatialReference);</span><br><span class="line">			IFeatureLayer pFeatureLayer &#x3D; new FeatureLayerClass();</span><br><span class="line">			pFeatureLayer.FeatureClass &#x3D; pFeatureClass;</span><br><span class="line">			pFeatureLayer.Name &#x3D; &quot;转换结果&quot;;</span><br><span class="line">			m_axMapControl.AddLayer(pFeatureLayer as ILayer, 0);</span><br><span class="line">			m_axMapControl.Refresh();</span><br><span class="line">			m_axTOCControl.Refresh();</span><br><span class="line">			this.Close();</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex)</span><br><span class="line">		&#123;</span><br><span class="line">			MessageBox.Show(ex+&quot;&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#x2F;&#x2F;&#x2F; 将带有x、y字段的ITable对象转化为IFeatureClass</span><br><span class="line">	private IFeatureClass OpenXYData(ITable pTable, string xName, string yName, string zName, ISpatialReference spatialReference)</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F; 将带有x、y字段的ITable对象转化为IFeatureClass,确定X、Y、Z字段以及空间参考坐标</span><br><span class="line">		&#x2F;&#x2F; xy字段属性描述</span><br><span class="line">		IXYEvent2FieldsProperties pXYEventFieldsPro &#x3D; new XYEvent2FieldsPropertiesClass();</span><br><span class="line">		pXYEventFieldsPro.XFieldName &#x3D; xName;</span><br><span class="line">		pXYEventFieldsPro.YFieldName &#x3D; yName;</span><br><span class="line">		pXYEventFieldsPro.ZFieldName &#x3D; zName;</span><br><span class="line"></span><br><span class="line">		&#x2F;&#x2F;XY事件 数据表名称描述</span><br><span class="line">		IXYEventSourceName pXYEventSourceName &#x3D; new XYEventSourceNameClass();</span><br><span class="line">		pXYEventSourceName.EventProperties &#x3D; pXYEventFieldsPro;</span><br><span class="line"></span><br><span class="line">		IDataset ds &#x3D; pTable as IDataset;</span><br><span class="line">		IName tname &#x3D; ds.FullName;</span><br><span class="line">		pXYEventSourceName.SpatialReference &#x3D; spatialReference;</span><br><span class="line">		pXYEventSourceName.EventTableName &#x3D; tname;</span><br><span class="line"></span><br><span class="line">		IName xyname &#x3D; pXYEventSourceName as IName;</span><br><span class="line">		IXYEventSource xysrc &#x3D; (IXYEventSource)xyname.Open();</span><br><span class="line">		return xysrc as IFeatureClass;</span><br><span class="line">	&#125;</span><br><span class="line">	&#x2F;&#x2F;&#x2F; 把DataTable转为ITable ,tempPath 不含文件名的问价夹路径</span><br><span class="line">	private ITable DataTableToITable(DataTable mTable, string xFieldName,string yFieldName,string tempPath)</span><br><span class="line">	&#123;</span><br><span class="line">		try</span><br><span class="line">		&#123;</span><br><span class="line">			#region 新建表字段</span><br><span class="line">			IField pField &#x3D; null;</span><br><span class="line">			IFields fields &#x3D; new FieldsClass();</span><br><span class="line">			IFieldsEdit fieldsEdit &#x3D; (IFieldsEdit)fields;</span><br><span class="line">			fieldsEdit.FieldCount_2 &#x3D;2;</span><br><span class="line">			&#x2F;&#x2F;添加X字段</span><br><span class="line">			pField &#x3D; new FieldClass();</span><br><span class="line">			IFieldEdit fieldEdit &#x3D; (IFieldEdit)pField;</span><br><span class="line">			fieldEdit.Name_2 &#x3D; &quot;X&quot;;</span><br><span class="line">			fieldEdit.AliasName_2 &#x3D; &quot;X&quot;;</span><br><span class="line">			&#x2F;&#x2F;设置字段类型</span><br><span class="line">			fieldEdit.Type_2 &#x3D; esriFieldType.esriFieldTypeDouble;</span><br><span class="line">			fieldEdit.Editable_2 &#x3D; true;</span><br><span class="line">			fieldsEdit.set_Field(0, pField);</span><br><span class="line">			&#x2F;&#x2F;添加Y字段</span><br><span class="line">			IField pField1 &#x3D; new FieldClass();</span><br><span class="line">			IFieldEdit fieldEdit1 &#x3D; (IFieldEdit)pField1;</span><br><span class="line">			fieldEdit1.Name_2 &#x3D; &quot;Y&quot;;</span><br><span class="line">			fieldEdit1.AliasName_2 &#x3D; &quot;Y&quot;;</span><br><span class="line">			fieldEdit1.Type_2 &#x3D; esriFieldType.esriFieldTypeDouble;</span><br><span class="line">			fieldEdit1.Editable_2 &#x3D; true;</span><br><span class="line">			fieldsEdit.set_Field(1, pField1);</span><br><span class="line">			#endregion</span><br><span class="line">			ShapefileWorkspaceFactoryClass class2 &#x3D; new ShapefileWorkspaceFactoryClass();</span><br><span class="line">			ESRI.ArcGIS.Geodatabase.IWorkspace pWorkspace &#x3D; class2.OpenFromFile(tempPath, 0);</span><br><span class="line">			IFeatureWorkspace pFWS &#x3D; pWorkspace as IFeatureWorkspace;</span><br><span class="line">			&#x2F;&#x2F;删除已有的</span><br><span class="line">			if (System.IO.File.Exists(tempPath + &quot;点数据.dbf&quot;))</span><br><span class="line">			&#123;</span><br><span class="line">				System.IO.File.Delete(tempPath + &quot;点数据.dbf&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			&#x2F;&#x2F;创建空表</span><br><span class="line">			ITable pTable &#x3D; pFWS.CreateTable(&quot;点数据&quot;, fieldsEdit, null, null, &quot;&quot;);</span><br><span class="line">			&#x2F;&#x2F;遍历DataTable中数据，然后转换为ITable中的数据</span><br><span class="line">			int xRowIndex &#x3D; pTable.Fields.FindField(&quot;X&quot;);</span><br><span class="line">			int yRowIndex &#x3D; pTable.Fields.FindField(&quot;Y&quot;);</span><br><span class="line">			for (int k &#x3D; 0; k &lt; mTable.Rows.Count; k++)</span><br><span class="line">			&#123;</span><br><span class="line">				&#x2F;&#x2F;ITable 的记录</span><br><span class="line">				IRow row &#x3D; pTable.CreateRow();</span><br><span class="line">				DataRow pRrow &#x3D; mTable.Rows[k];</span><br><span class="line">				row.set_Value(xRowIndex, pRrow[xFieldName]);</span><br><span class="line">				row.set_Value(yRowIndex, pRrow[yFieldName]);</span><br><span class="line">				row.Store();                </span><br><span class="line">			&#125;</span><br><span class="line">			return pTable;</span><br><span class="line">		&#125;</span><br><span class="line">		catch </span><br><span class="line">		&#123;</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private void btnCancle_Click(object sender, EventArgs e)</span><br><span class="line">	&#123;</span><br><span class="line">		this.Close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="GP调用缓冲区"><a href="#GP调用缓冲区" class="headerlink" title="GP调用缓冲区"></a>GP调用缓冲区</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F;&#x2F; GP工具调用，生成缓冲区</span><br><span class="line">private void btnGPBuffer_Click(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">	try</span><br><span class="line">	&#123;</span><br><span class="line">		&#x2F;&#x2F;缓冲区分析-GP工具调用</span><br><span class="line">		Geoprocessor gp &#x3D; new Geoprocessor();</span><br><span class="line">		gp.OverwriteOutput &#x3D; true;</span><br><span class="line">		ESRI.ArcGIS.AnalysisTools.Buffer pBuffer &#x3D; new ESRI.ArcGIS.AnalysisTools.Buffer();</span><br><span class="line">		&#x2F;&#x2F;获取缓冲区分析图层</span><br><span class="line">		ILayer pLayer &#x3D; axMapControl1.get_Layer(0);</span><br><span class="line">		IFeatureLayer featLayer &#x3D; pLayer as IFeatureLayer;</span><br><span class="line">		pBuffer.in_features &#x3D; featLayer;</span><br><span class="line">		string filepath &#x3D; @&quot;c:\dat\&quot;;&#x2F;&#x2F;如果路径或文件夹不存在会报错</span><br><span class="line">		&#x2F;&#x2F;设置生成结果存储路径</span><br><span class="line">		pBuffer.out_feature_class &#x3D; filepath + &quot;\\&quot; + pLayer.Name + &quot;.shp&quot;;</span><br><span class="line">		&#x2F;&#x2F;设置缓冲区距离</span><br><span class="line">		pBuffer.buffer_distance_or_field &#x3D; &quot;500 Meters&quot;;</span><br><span class="line">		pBuffer.dissolve_option &#x3D; &quot;ALL&quot;;</span><br><span class="line">		&#x2F;&#x2F;执行缓冲区分析</span><br><span class="line">		gp.Execute(pBuffer, null);</span><br><span class="line">		&#x2F;&#x2F;将生成结果添加到地图中</span><br><span class="line">		this.axMapControl1.AddShapeFile(filepath, pLayer.Name);</span><br><span class="line">		this.axMapControl1.MoveLayerTo(0, 0);</span><br><span class="line">	&#125;</span><br><span class="line">	catch &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




  </article>
</div>


    




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://fungiser.github.io" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 努力搬砖的giser</li>
      <li><a href="https://fungiser.github.io">Home</a></li>
      
      <li><a href="https://github.com/fungiser" target="_blank" rel="noopener">Github</a></li>
      
      <li><a href="https://blog.csdn.net/qq_41441896?t=1" target="_blank" rel="noopener">Weibo</a></li>
      
      <li><a href="https://blog.csdn.net/qq_41441896?t=1" target="_blank" rel="noopener">Linkedin</a></li>
      
    </ul>
    <div class="footer-theme-info">
      Theme <a href="//github.com/sabrinaluo/hexo-theme-replica" target="_blank" rel="noopener">Replica</a>
      by fungis</a> ❤ Powered by Hexo
    </div>
    </div>
    
  </footer>
</div>




<script src="/js/main.js"></script>

</body>
</html>
